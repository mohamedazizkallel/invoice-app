{% extends 'partials/base.html' %}
{% load static %}

{% block css %}
<style>
  .page-header {
    background: white;
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  }
  
  .settings-container {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    padding: 2rem;
    max-width: 800px;
    margin: 0 auto;
  }
  
  .logo-preview {
    max-width: 200px;
    margin-top: 1rem;
    border: 2px dashed #dee2e6;
    padding: 1rem;
    border-radius: 0.5rem;
  }
  
  .logo-preview img {
    max-width: 100%;
    height: auto;
  }
</style>
{% endblock %}

{% block main %}
<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="h2 mb-0">
      <i class="bi bi-gear me-2"></i> Company Settings
    </h1>
    <p class="text-muted mb-0 mt-2">Manage your company information and invoice defaults</p>
  </div>

  <!-- Settings Form -->
  <div class="settings-container">
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      
      {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
      {% endif %}

      {% if form.errors %}
      <div class="alert alert-danger rounded-3" role="alert">
        <strong><i class="bi bi-exclamation-triangle me-2"></i> Please correct the following errors:</strong>
        <ul class="mt-2 mb-0">
          {% for field, errors in form.errors.items %}
            {% for error in errors %}
            <li>{{ field }}: {{ error }}</li>
            {% endfor %}
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      <div class="row g-3">
        <!-- Company Name -->
        <div class="col-12">
          <label for="{{ form.clientname.id_for_label }}" class="form-label fw-semibold">
            {{ form.clientname.label }}
          </label>
          {{ form.clientname }}
          {% if form.clientname.help_text %}
          <small class="form-text text-muted">{{ form.clientname.help_text }}</small>
          {% endif %}
        </div>

        <!-- Company Address -->
        <div class="col-12">
          <label for="{{ form.adress.id_for_label }}" class="form-label fw-semibold">
            {{ form.adress.label }}
          </label>
          {{ form.adress }}
          {% if form.adress.help_text %}
          <small class="form-text text-muted">{{ form.adress.help_text }}</small>
          {% endif %}
        </div>

        <!-- Tax Registration (MF) -->
        <div class="col-12">
          <label for="{{ form.mf.id_for_label }}" class="form-label fw-semibold">
            {{ form.mf.label }}
          </label>
          {{ form.mf }}
          {% if form.mf.help_text %}
          <small class="form-text text-muted">{{ form.mf.help_text }}</small>
          {% endif %}
        </div>

        <!-- TVA -->
        <div class="col-12">
          <label for="{{ form.tva.id_for_label }}" class="form-label fw-semibold">
            {{ form.tva.label }}
          </label>
          {{ form.tva }}
          {% if form.tva.help_text %}
          <small class="form-text text-muted">{{ form.tva.help_text }}</small>
          {% endif %}
        </div>

        <!-- DT -->
        <div class="col-12">
          <label for="{{ form.dt.id_for_label }}" class="form-label fw-semibold">
            {{ form.dt.label }}
          </label>
          {{ form.dt }}
          {% if form.dt.help_text %}
          <small class="form-text text-muted">{{ form.dt.help_text }}</small>
          {% endif %}
        </div>

        <!-- Company Logo -->
        <div class="col-12">
          <label for="{{ form.clientLogo.id_for_label }}" class="form-label fw-semibold">
            {{ form.clientLogo.label }}
          </label>
          {{ form.clientLogo }}
          {% if form.clientLogo.help_text %}
          <small class="form-text text-muted">{{ form.clientLogo.help_text }}</small>
          {% endif %}
          
          {% if settings and settings.clientLogo %}
          <div class="logo-preview">
            <p class="text-muted small mb-2">Current Logo:</p>
            <img src="{{ settings.clientLogo.url }}" alt="Company Logo">
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Invoice Defaults Information -->
      <div class="alert alert-info mt-4" role="alert">
        <h6 class="alert-heading">
          <i class="bi bi-info-circle me-2"></i> Invoice Defaults
        </h6>
        <p class="mb-0 small">
          Default values for new invoices:
        </p>
        <ul class="mb-0 mt-2 small">
          <li><strong>TVA (Tax):</strong> 19.00% (modifiable per invoice)</li>
          <li><strong>Timbre Fiscal (D):</strong> 1.000 TND (modifiable per invoice)</li>
          <li><strong>Discount (DT):</strong> 0.00% (modifiable per invoice)</li>
        </ul>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex gap-2 justify-content-end mt-4">
        <a href="{% url 'dashboard' %}" class="btn btn-light px-4">Cancel</a>
        <button type="submit" class="btn btn-primary px-4">
          <i class="bi bi-check-circle me-1"></i> Save Settings
        </button>
      </div>
    </form>
  </div>
</main>
{% endblock %}